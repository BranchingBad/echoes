<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Braille Converter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        /* Style for Braille text output, using a mono font for consistent dots */
        .braille-text {
            font-family: monospace, "Braille", sans-serif;
            line-height: 1.5;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6">
    <div class="bg-white rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-4xl border border-gray-200">
        <header class="text-center mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 tracking-tight">Braille Converter</h1>
            <p class="mt-2 text-gray-500 text-lg">Convert text to Braille or vice versa using the Python logic.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8">
            <div class="space-y-6">
                <div class="relative">
                    <label for="text-input" class="block text-gray-700 font-medium mb-2" id="input-label">Enter Text</label>
                    <textarea id="text-input" rows="8" placeholder="Type or paste your text here..."
                        class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300 ease-in-out resize-none text-gray-800"></textarea>
                </div>

                <div class="flex flex-col sm:flex-row sm:items-center justify-between space-y-4 sm:space-y-0 sm:space-x-4">
                    <div class="flex-grow">
                        <label for="conversion-type" class="block text-gray-700 font-medium mb-2">Conversion Type</label>
                        <select id="conversion-type"
                            class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300 ease-in-out text-gray-700">
                            <option value="to_braille_g1">Text to Braille (Grade 1)</option>
                            <option value="to_text">Braille to Text</option>
                        </select>
                    </div>

                    <button id="convert-button"
                        class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-300 ease-in-out">
                        Convert
                    </button>
                </div>
            </div>

            <div class="space-y-6">
                <div class="relative">
                    <label for="braille-output" class="block text-gray-700 font-medium mb-2" id="output-label">Braille Output (Grade 1)</label>
                    <div id="braille-output" class="braille-output-box w-full min-h-[14rem] p-4 bg-gray-50 border border-gray-300 rounded-lg shadow-inner overflow-y-auto cursor-text text-gray-800 braille-text" contenteditable="true">
                        The converted Braille text will appear here.
                    </div>
                </div>

                <button id="copy-button"
                    class="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-300 ease-in-out flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                    </svg>
                    Copy to Clipboard
                </button>
            </div>
        </div>
        
        <div id="alert-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 w-full max-w-sm text-center">
                <h3 id="alert-title" class="text-xl font-bold text-gray-800 mb-4"></h3>
                <p id="alert-message" class="text-gray-600 mb-6"></p>
                <button id="alert-close-button" class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none">OK</button>
            </div>
        </div>
    </div>

    <script>
        (async function() {
            // --- UI Elements ---
            const API_ENDPOINT = 'http://localhost:5000/convert'; // Adjust this for production
            const TEXT_INPUT = document.getElementById('text-input');
            const BRAILLE_OUTPUT = document.getElementById('braille-output');
            const CONVERT_BUTTON = document.getElementById('convert-button');
            const CONVERSION_TYPE_SELECT = document.getElementById('conversion-type');
            const COPY_BUTTON = document.getElementById('copy-button');
            const ALERT_MODAL = document.getElementById('alert-modal');
            const ALERT_TITLE = document.getElementById('alert-title');
            const ALERT_MESSAGE = document.getElementById('alert-message');
            const ALERT_CLOSE_BUTTON = document.getElementById('alert-close-button');
            const INPUT_LABEL = document.getElementById('input-label');
            const OUTPUT_LABEL = document.getElementById('output-label');

            // --- Custom Alert Function ---
            function showCustomAlert(title, message) {
                ALERT_TITLE.textContent = title;
                ALERT_MESSAGE.textContent = message;
                ALERT_MODAL.classList.remove('hidden');
            }

            ALERT_CLOSE_BUTTON.addEventListener('click', () => {
                ALERT_MODAL.classList.add('hidden');
            });

            // --- Conversion Logic: Calls Python Backend via Fetch API ---
            CONVERT_BUTTON.addEventListener('click', async () => {
                const inputText = TEXT_INPUT.value;
                const conversionType = CONVERSION_TYPE_SELECT.value;
                
                if (!inputText.trim()) {
                    showCustomAlert("Input Empty", "Please enter text or Braille to convert.");
                    return;
                }

                try {
                    CONVERT_BUTTON.textContent = 'Converting...';
                    CONVERT_BUTTON.disabled = true;

                    const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            text: inputText,
                            conversion_type: conversionType
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        BRAILLE_OUTPUT.textContent = data.result;
                    } else {
                        // Handle server-side errors (e.g., 500, or custom 400 from Flask)
                        showCustomAlert("Conversion Error", data.error || "An unknown error occurred during conversion.");
                        BRAILLE_OUTPUT.textContent = 'ERROR: See alert for details.';
                    }
                } catch (error) {
                    // Handle network errors (e.g., Python server is not running)
                    console.error('Network Error:', error);
                    showCustomAlert("Connection Error", "Could not connect to the conversion server. Ensure the Python backend is running.");
                    BRAILLE_OUTPUT.textContent = 'ERROR: Server connection failed.';
                } finally {
                    CONVERT_BUTTON.textContent = 'Convert';
                    CONVERT_BUTTON.disabled = false;
                }
            });
            
            // --- UI Updates on Conversion Type Change ---
            CONVERSION_TYPE_SELECT.addEventListener('change', () => {
                const type = CONVERSION_TYPE_SELECT.value;
                if (type === "to_braille_g1") { // Simplified logic
                    const grade = "Grade 1";
                    INPUT_LABEL.textContent = "Enter Text";
                    OUTPUT_LABEL.textContent = `Braille Output (${grade})`;
                    TEXT_INPUT.placeholder = "Type or paste your English text here...";
                    BRAILLE_OUTPUT.textContent = "The converted Braille text will appear here.";
                    BRAILLE_OUTPUT.classList.add('braille-text');
                } else { // to_text
                    INPUT_LABEL.textContent = "Enter Braille";
                    OUTPUT_LABEL.textContent = "Text Output";
                    TEXT_INPUT.placeholder = "Paste your Braille here...";
                    BRAILLE_OUTPUT.textContent = "The converted plain text will appear here.";
                    BRAILLE_OUTPUT.classList.remove('braille-text');
                }
                TEXT_INPUT.value = "";
                BRAILLE_OUTPUT.textContent = "";
            });

            // --- Copy to Clipboard Logic ---
            COPY_BUTTON.addEventListener('click', () => {
                const textToCopy = BRAILLE_OUTPUT.textContent;
                if (!textToCopy.trim() || textToCopy.includes('ERROR')) {
                    showCustomAlert("Nothing to Copy", "The output box is empty or contains an error message.");
                    return;
                }
                
                const tempTextArea = document.createElement("textarea");
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    showCustomAlert("Success!", "Text has been copied to your clipboard.");
                } catch (err) {
                    showCustomAlert("Copy Failed", "Failed to copy text. Please try again.");
                } finally {
                    document.body.removeChild(tempTextArea);
                }
            });
            
            // Set initial state correctly since Grade 2 is removed
            document.addEventListener('DOMContentLoaded', () => {
                // Manually trigger the change event to set initial labels for Grade 1
                CONVERSION_TYPE_SELECT.value = 'to_braille_g1';
                CONVERSION_TYPE_SELECT.dispatchEvent(new Event('change'));
            });
            
        })();
    </script>
</body>
</html>